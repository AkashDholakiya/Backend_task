import AdminJS from "adminjs";
import AdminJSExpress from "@adminjs/express";
import * as AdminJSMongoose from '@adminjs/mongoose';  
import Faq from "../models/faqModel.js";
import dotenv from "dotenv";

dotenv.config();

// Register the adapter
AdminJS.registerAdapter(AdminJSMongoose);

const admin = new AdminJS({
  resources: [Faq],
  rootPath: "/admin",
  branding: { 
    companyName: "BharatFD Admin",
    logo: `data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20viewBox%3D%220%200%20154%2032%22%3E%3Cg%20transform%3D%22translate(0.129%200.129)%22%20id%3D%22ss11303002675_1%22%3E%3Cpath%20d%3D%22M%200%200%20L%20153.741%200%20L%20153.741%2031.742%20L%200%2031.742%20Z%22%20fill%3D%22transparent%22%3E%3C%2Fpath%3E%3Cg%20transform%3D%22translate(0.228%200)%22%20id%3D%22ss11303002675_3%22%3E%3Cg%20id%3D%22ss11303002675_4%22%3E%3Cg%20transform%3D%22translate(38.549%205.442)%22%20id%3D%22ss11303002675_5%22%3E%3Cpath%20d%3D%22M%2014.378%2014.941%20C%2014.378%2017.702%2012.398%2020.519%208.295%2020.519%20L%200%2020.519%20L%200%200.91%20L%207.691%200.91%20C%2011.135%200.91%2013.316%202.959%2013.316%205.947%20C%2013.316%207.484%2012.741%209.334%2010.733%2010.045%20C%2013.143%2010.528%2014.378%2012.777%2014.378%2014.939%20Z%20M%207.547%204.012%20L%203.5%204.012%20L%203.5%208.823%20L%207.547%208.823%20C%209.011%208.823%209.815%207.854%209.815%206.433%20C%209.815%205.011%209.07%204.015%207.547%204.015%20L%207.547%204.013%20Z%20M%207.748%2017.416%20C%209.787%2017.416%2010.847%2016.079%2010.847%2014.599%20C%2010.847%2013.204%209.929%2011.754%207.834%2011.754%20L%203.5%2011.754%20L%203.5%2017.418%20L%207.748%2017.418%20L%207.748%2017.416%20Z%20M%2029.186%2013.063%20L%2029.186%2020.519%20L%2025.856%2020.519%20L%2025.856%2013.29%20C%2025.856%2011.156%2024.565%2010.019%2023.072%2010.019%20C%2021.58%2010.019%2019.657%2010.901%2019.657%2013.49%20L%2019.657%2020.519%20L%2016.327%2020.519%20L%2016.327%200%20L%2019.657%200%20L%2019.657%209.25%20C%2020.317%207.627%2022.469%206.888%2023.817%206.888%20C%2027.261%206.888%2029.184%209.193%2029.184%2013.063%20Z%20M%2042.071%207.228%20L%2045.401%207.228%20L%2045.401%2020.519%20L%2042.071%2020.519%20L%2042.071%2018.441%20C%2041.182%2019.892%2039.403%2020.859%2037.478%2020.859%20C%2033.891%2020.859%2031.022%2017.984%2031.022%2013.858%20C%2031.022%209.733%2033.777%206.886%2037.566%206.886%20C%2039.403%206.886%2041.182%207.683%2042.071%209.076%20L%2042.071%207.226%20Z%20M%2042.012%2013.858%20C%2042.012%2011.581%2040.118%209.96%2038.138%209.96%20C%2035.986%209.96%2034.35%2011.724%2034.35%2013.858%20C%2034.35%2015.993%2035.986%2017.787%2038.167%2017.787%20C%2040.234%2017.787%2042.012%2016.079%2042.012%2013.858%20Z%20M%2057.568%207.343%20L%2056.908%2010.474%20C%2056.132%2010.075%2055.444%209.99%2054.957%209.99%20C%2052.776%209.99%2051.57%2012.153%2051.57%2015.882%20L%2051.57%2020.521%20L%2048.212%2020.521%20L%2048.212%207.228%20L%2051.541%207.228%20L%2051.541%2010.073%20C%2052.258%207.854%2053.722%206.886%2055.387%206.886%20C%2056.191%206.886%2057.052%207.057%2057.568%207.341%20Z%20M%2068.443%207.228%20L%2071.773%207.228%20L%2071.773%2020.519%20L%2068.443%2020.519%20L%2068.443%2018.441%20C%2067.554%2019.892%2065.775%2020.859%2063.85%2020.859%20C%2060.263%2020.859%2057.394%2017.984%2057.394%2013.858%20C%2057.394%209.733%2060.149%206.886%2063.938%206.886%20C%2065.775%206.886%2067.554%207.683%2068.443%209.076%20L%2068.443%207.226%20Z%20M%2068.387%2013.858%20C%2068.387%2011.581%2066.492%209.96%2064.512%209.96%20C%2062.36%209.96%2060.723%2011.724%2060.723%2013.858%20C%2060.723%2015.993%2062.36%2017.787%2064.541%2017.787%20C%2066.608%2017.787%2068.387%2016.079%2068.387%2013.858%20Z%20M%2081.96%207.228%20L%2081.96%209.846%20L%2079.12%209.846%20L%2079.12%2020.517%20L%2075.789%2020.517%20L%2075.789%209.846%20L%2073.379%209.846%20L%2073.379%207.228%20L%2075.789%207.228%20L%2075.789%202.333%20L%2079.12%202.333%20L%2079.12%207.228%20Z%22%20fill%3D%22rgb(44%2C56%2C122)%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M%2095.907%204.013%20L%2087.412%204.013%20L%2087.412%209.334%20L%2094.127%209.334%20L%2094.127%2012.437%20L%2087.412%2012.437%20L%2087.412%2020.519%20L%2083.911%2020.519%20L%2083.911%200.91%20L%2095.907%200.91%20Z%20M%20105.325%200.91%20C%20110.978%200.91%20114.279%205.178%20114.279%2010.756%20C%20114.279%2016.333%20110.98%2020.517%20105.325%2020.517%20L%2097.576%2020.517%20L%2097.576%200.91%20Z%20M%20105.325%2017.416%20C%20108.913%2017.416%20110.748%2014.4%20110.748%2010.758%20C%20110.748%207.115%20108.911%204.013%20105.325%204.013%20L%20101.077%204.013%20L%20101.077%2017.416%20Z%22%20fill%3D%22rgb(228%2C128%2C58)%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20id%3D%22ss11303002675_8%22%3E%3Cg%20id%3D%22ss11303002675_9%22%3E%3Cpath%20d%3D%22M%2015.739%2031.289%20C%2024.431%2031.289%2031.478%2024.284%2031.478%2015.644%20C%2031.478%207.004%2024.431%200%2015.739%200%20C%207.046%200%200%207.004%200%2015.644%20C%200%2024.284%207.046%2031.289%2015.739%2031.289%20Z%22%20fill%3D%22rgb(44%2C56%2C122)%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M%2023.659%209.28%20L%2023.088%207.509%20L%2016.363%207.509%20L%2016.933%209.28%20L%2019.108%209.28%20L%2019.108%2016.999%20L%2016.02%2016.999%20L%2016.02%2010.983%20C%2016.02%208.968%2014.371%207.329%2012.344%207.329%20C%2010.316%207.329%208.668%208.968%208.668%2010.983%20C%208.668%2012.998%2010.316%2014.637%2012.344%2014.637%20C%2013.012%2014.637%2013.667%2014.454%2014.238%2014.108%20L%2014.238%2016.999%20L%2012.344%2016.999%20C%2010.316%2016.999%208.668%2018.637%208.668%2020.653%20C%208.668%2022.668%2010.316%2024.307%2012.344%2024.307%20C%2014.371%2024.307%2016.02%2022.668%2016.02%2020.653%20L%2016.02%2018.77%20L%2019.108%2018.77%20L%2019.108%2024.293%20L%2020.889%2022.966%20L%2020.889%209.28%20Z%20M%2012.345%2012.865%20C%2011.302%2012.865%2010.451%2012.019%2010.451%2010.981%20C%2010.451%209.944%2011.3%209.098%2012.346%209.098%20C%2013.391%209.098%2014.24%209.944%2014.24%2010.981%20C%2014.24%2012.019%2013.391%2012.865%2012.346%2012.865%20Z%20M%2012.345%2022.534%20C%2011.302%2022.534%2010.451%2021.691%2010.451%2020.651%20C%2010.451%2020.152%2010.651%2019.673%2011.006%2019.32%20C%2011.746%2018.584%2012.944%2018.584%2013.685%2019.32%20C%2014.04%2019.672%2014.24%2020.152%2014.24%2020.651%20C%2014.24%2021.151%2014.04%2021.63%2013.685%2021.983%20C%2013.329%2022.336%2012.848%2022.535%2012.345%2022.534%20Z%22%20fill%3D%22rgb(255%2C255%2C255)%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E`,
  },
});

// Secure AdminJS with authentication
const adminRouter = AdminJSExpress.buildAuthenticatedRouter(admin, {
  authenticate: async (email, password) => {
    if (
      email === process.env.ADMIN_EMAIL &&
      password === process.env.ADMIN_PASSWORD
    ) {
      return { email, role: "admin" };
    }
    return null;
  },
  cookieName: "adminjs",
  cookiePassword: process.env.COOKIE_SECRET,
});

export { admin, adminRouter };
